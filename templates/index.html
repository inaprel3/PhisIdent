<!-- templates/index.html --> 
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <title>Phishing Identification</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="header-flex">
        <img src="{{ url_for('static', filename='pictures/mess.gif') }}" alt="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è" class="gif-mess">
        <h1>Phishing Identification</h1>
        <img src="{{ url_for('static', filename='pictures/mess.gif') }}" alt="–ü–æ—Å–∏–ª–∞–Ω–Ω—è" class="gif-mess">
    </div>
    
    <div class="cards">
        <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
        <div class="card" id="messageCard">
            <h2>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è üì®</h2>
            <textarea id="message" maxlength="1000" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è" oninput="autoResize(this)"></textarea>
            <button onclick="checkMessage()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
            <p id="messageResult"></p>

            <div class="recommendation">
                <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h3>
                <p id="messageRecommendation"></p>
            </div>

            <textarea id="messageFeedback" placeholder="–í–∞—à –≤—ñ–¥–≥—É–∫ –ø—Ä–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—é"></textarea>
            <button onclick="sendFeedback('message')">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
            <p id="messageFeedbackStatus"></p>
        </div>

        <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è -->
        <div class="card" id="urlCard">
            <h2>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è üîó</h2>
            <input type="text" id="url" placeholder="–í–≤–µ–¥—ñ—Ç—å URL-–ø–æ—Å–∏–ª–∞–Ω–Ω—è">
            <button onclick="checkURL()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</button>
            <p id="urlResult"></p>

            <div class="recommendation">
                <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h3>
                <p id="urlRecommendation"></p>
            </div>

            <textarea id="urlFeedback" placeholder="–í–∞—à –≤—ñ–¥–≥—É–∫ –ø—Ä–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—é"></textarea>
            <button onclick="sendFeedback('url')">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—ñ–¥–≥—É–∫</button>
            <p id="urlFeedbackStatus"></p>
        </div>
    </div>
</div>

<script>
const recommendations = {
    "request_click_link": "‚ö†Ô∏è –ù–µ –ø–µ—Ä–µ—Ö–æ–¥—å—Ç–µ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º! –¶–µ –º–æ–∂–µ –±—É—Ç–∏ —à–∞—Ö—Ä–∞–π—Å—Ç–≤–æ.",
    "account_blocked": "‚ö†Ô∏è –í–∞—à –∞–∫–∞—É–Ω—Ç –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —à–∞—Ö—Ä–∞—ó. –ù–µ –ø–æ–≤—ñ–¥–æ–º–ª—è–π—Ç–µ —Å–≤–æ—ó –¥–∞–Ω—ñ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–º—É —Å–∞–π—Ç—ñ.",
    "payment_alert": "‚ö†Ô∏è –ù–µ –∑–¥—ñ–π—Å–Ω—é–π—Ç–µ –æ–ø–ª–∞—Ç—É, –¥–æ–∫–∏ –Ω–µ –ø–µ—Ä–µ–∫–æ–Ω–∞—î—Ç–µ—Å—å —É –¥–æ—Å—Ç–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.",
    "default": "‚ö†Ô∏è –ù–µ–±–µ–∑–ø–µ—á–Ω–æ –¥–æ–≤—ñ—Ä—è—Ç–∏ —Ü—å–æ–º—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—é!"
};

async function checkMessage() {
    const message = document.getElementById("message").value.trim();
    const card = document.getElementById("messageCard");
    const resultEl = document.getElementById("messageResult");
    const recEl = document.getElementById("messageRecommendation");

    card.classList.remove("safe", "phishing", "warning");
    resultEl.classList.remove("warning");
    recEl.innerText = "";

    if (message === "") {
        resultEl.innerText = "‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏";
        resultEl.classList.add("warning");
        card.classList.add("warning");
        return;
    }

    const res = await fetch("/check_message", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
    });
    const data = await res.json();
    resultEl.innerText = data.result;

    if (data.result.toLowerCase().includes("–±–µ–∑–ø–µ—á")) {
        card.classList.add("safe");
        recEl.innerText = "‚úÖ –ú–æ–∂–Ω–∞ –¥–æ–≤—ñ—Ä—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—é.";
    } else if (data.result.toLowerCase().includes("—Ñ—ñ—à–∏–Ω–≥")) {
        card.classList.add("phishing");
        recEl.innerText = recommendations[data.category] || recommendations["default"];
    } else {
        card.classList.add("warning");
        resultEl.classList.add("warning");
    }
}

async function checkURL() {
    const url = document.getElementById("url").value.trim();
    const card = document.getElementById("urlCard");
    const resultEl = document.getElementById("urlResult");
    const recEl = document.getElementById("urlRecommendation");

    card.classList.remove("safe", "phishing", "warning");
    resultEl.classList.remove("warning");
    recEl.innerText = "";

    if (url === "") {
        resultEl.innerText = "‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å URL-–ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏";
        resultEl.classList.add("warning");
        card.classList.add("warning");
        return;
    }

    const res = await fetch("/check_url", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
    });
    const data = await res.json();
    resultEl.innerText = data.result;

    if (data.result.toLowerCase().includes("–±–µ–∑–ø–µ—á")) {
        card.classList.add("safe");
        recEl.innerText = "‚úÖ –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º.";
    } else if (data.result.toLowerCase().includes("—Ñ—ñ—à–∏–Ω–≥")) {
        card.classList.add("phishing");
        recEl.innerText = "‚ö†Ô∏è –ù–µ–±–µ–∑–ø–µ—á–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –∑–∞ —Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º!";
    } else {
        card.classList.add("warning");
        resultEl.classList.add("warning");
    }
}

async function sendFeedback(type) {
    const content = type === 'message'
        ? document.getElementById('message').value
        : document.getElementById('url').value;
    const feedbackText = type === 'message'
        ? document.getElementById('messageFeedback').value
        : document.getElementById('urlFeedback').value;
    const resultText = type === 'message'
        ? document.getElementById('messageResult').innerText
        : document.getElementById('urlResult').innerText;
    const statusEl = type === 'message'
        ? document.getElementById('messageFeedbackStatus')
        : document.getElementById('urlFeedbackStatus');

    if (!feedbackText.trim()) {
        statusEl.innerText = "‚ö†Ô∏è –ù–∞–ø–∏—à—ñ—Ç—å —Å–≤—ñ–π –≤—ñ–¥–≥—É–∫.";
        return;
    }

    try {
        const res = await fetch("/feedback", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                type,
                content,
                system_result: resultText,
                user_opinion: feedbackText
            })
        });
        const data = await res.json();
        statusEl.innerText = data.message;

        if (type === 'message') document.getElementById('messageFeedback').value = "";
        else document.getElementById('urlFeedback').value = "";
    } catch (err) {
        console.error(err);
        statusEl.innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É";
    }
}

function autoResize(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
}

window.addEventListener('DOMContentLoaded', () => {
    const textarea = document.getElementById('message');
    if (textarea.value.length > 0) autoResize(textarea);
});
</script>
</body>
</html>